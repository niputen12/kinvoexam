<!DOCTYPE html>
<html>
<head>
  <title>
    ACME Company
  </title>
        <style>


.Bottom {
          bottom: 0;
          width:100%;
          height: 60px;
        }

       
        .Bottom p {
          margin:0;
          padding:10px;
        }


 #acount_settings_dropdown{
  height: 40px!important;
  width: 40px!important;
  padding:0 0 0 0;
  margin-right: 40px;
  border-radius: 50%;

 }
 #dropdown-activate1{
  width: 180px!important;
  margin-top: 40px!important;
  position: absolute;
  padding: 0px;

 }

</style>
      <link rel= "stylesheet" type= "text/css" href= "css/acme_css.css" >
       <link rel= "stylesheet" type= "text/css" href= "css/materialize.css" >
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <script type= "text/javascript" src= "js/jquery.min.js"> </script>
        <script type= "text/javascript" src= "js/materialize.js"> </script>
        <script type= "text/javascript" src= "js/materialize.min.js"> </script>
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
      </head>
<body>

<div class="loginfb">
  <div class="row center">
        <div class="col s12" style="margin-top: 5%;">
          <div class="card #ffffff white z-depth-3">
            <div class="card-content">
              <div class="section"></div>
<div class="section"></div>
<div class="section"></div>
              <span class="card-title">WELCOME TO ACME COMPANY</span>
              <p>We provide what you need.</p>
            </div>
            <div class="section"></div>
             <fb:login-button 
                scope="public_profile,email,manage_pages,publish_pages,publish_actions,read_page_mailboxes"
                onlogin="checkLoginState();">
              </fb:login-button>
            </button>
         <div class="section"></div>
         <div class="section"></div>
<div class="section"></div>
<div class="section"></div>        
          </div>
        </div>
      </div>
   </div>   
   <div class="fillupPage">     
     <div id="header">
    <div class="navbar-fixed" style="height: 90px;">
    <nav style="height: 90px;">
      <div class="nav-wrapper #ffffff white" style="height: 90px;">
        
        <div class="container">
      <a href="#" style="font-size: 3rem; color: #009688;"><img class="responsive-img" src="images/acmelogov4.png" style="height: 90px; width: 150px;">
   
    <div class="row" style="margin-top: -100px;">
            <div class="right">
              <a class="dropdown-button btn N/A transparent  hoverable show-on-small-only " data-activates="dropdown-activate1" id="acount_settings_dropdown"><img id="acount_settings_dropdown_image" class ="responsive-img circle show-on-med-and-down" src="images/fb.png"></a>
            </div>
          
            <div id="profile-dropdown" class="dropdown-content">
              <ul  id='dropdown-activate1' style="background-color: #009688;" class='dropdown-content '>
               
                <li><a class="white-text logout" ><i class="material-icons">trending_flat</i>Logout</a></li>
              </ul>
            </div>
          </div>

      </div>
      </div>
    </nav>
 </div>    
 </div>        
        <div class="section"></div>
        <div class="row center " id="contactus" style="padding:0px 15px 0px 15px;">
        <div class="col xl7 l12 m12 s12 offset-xl3">
          <div class="card #ffffff white z-depth-3 " style="padding: 0px; margin: 0px;">
            <div class="container card-content">
              <div class="section"></div>

              <span id="contact" class="card-title">Post on Facebook</span>
           
              <div class="section"></div>


<div class="row center-align">
          <div class="input-field col l12 m12 s12">
    <select class = "pages">
       
    </select>
    <label style="font-size: 15px;" class="black-text">Choose Page</label>
  </div>
      </div>

       <div class="row" style="margin-top: -25px;">
    <form class="col l12 m12 s12">
      <div class="row">
        <div class="input-field col s12">
          <textarea id="textarea1" class="materialize-textarea caption"></textarea>
          <label for="textarea1" class="black-text">Caption</label>
        </div>
      </div>
    </form>
  </div>    
          <div class="row" style="margin-top: -25px;">
    <form class="col l12 m12 s12">
      <div class="row">
        <div class="input-field col s12">
          <textarea id="textarea2" class="materialize-textarea tags"></textarea>
          <label for="textarea2" class="black-text">Tag</label>
        </div>
      </div>
    </form>
  </div>

      <div class="row">
        <div class="input-field col l12 m12 s12">
          <input id="reply" type="text" class="validate pmReply">
          <label for="reply " class="black-text">Page's Private Reply</label>
        </div>
      </div>
      <div class="row">
        <div class="input-field col l12 m12 s12">
          <input id="comment" type="text" class="validate reply">
          <label for="comment" class="black-text">Page's Comment Reply</label>
        </div>
      </div>
      <button class="btn waves-effect waves-light col l12 m12 s12 send" type="button" name="action">Send              
            </button>            
            </div>           
         <div class="section"></div>
         <div class="section"></div>        
          </div>
      
        </div>
      </div>         
  <footer id="footer"  class="page-footer  N/A transparent Bottom ">
  <div class="footer-copyright #455a64 blue-grey darken-2">
    <div class="container center white-text" style="opacity: 0.3; font-size: 0.9rem;">
      Â© 2018 ACME COMPANY
    </div>
  </div>
</footer>
</body>
</html>

<script> 
  setInterval(getPost, 6000)
  var counter ;

  function getPost()
  {
    var page_id = $('.pages option:selected').val();
    $.get('http://localhost:3000/getPosts', function(responsee){
        counter = Object.keys(responsee.data).length;
          
       for(i = 0 ; i < counter ; i++)
          {
             var pid = responsee.data[i].id;
             var done = responsee.data[i].done;
             var message = responsee.data[i].reply;
             var msg = responsee.data[i].tags;
             var oid = responsee.data[i].postId;
             var pmmsg = responsee.data[i].pmReply;
               FB.api(
                    "/"+responsee.data[i].postId+"/comments",
                    {
                        "summary": true
                        
                    },
                    function (response) {
                      //console.log('wat', response);
                      if (response && !response.error) {

                        for ( j = 0 ; j < response.data.length ; j++){
                            //console.log('mensahe',response.data[j].message)
                          if(response.data[j].message === msg){
                             var id = response.data[j].id
                             FB.api('/' + page_id, {fields: 'access_token'}, function(resp) {
                              if(resp.access_token) {                           
                                 // console.log('wat',id);
                                         FB.api('/'+id+'/comments', 
                                          'post', { 'message' : message,
                                          access_token: resp.access_token }, function(res){
                                           // console.log('msg',res);
                                             if(done=="false")  {
                                                     FB.api(
                                                      "/"+id+"/private_replies",
                                                      "POST",
                                                      {
                                                        id: id,
                                                        message: pmmsg,
                                                        access_token: resp.access_token
                                                      },
                                                      function (response) {
                                                        if (response && !response.error) {
                                                          //console.log('is this for real?');
                                                        }
                                                        else{
                                                          //console.log(response);
                                                        }
                                                      }
                                                  );
                                               }
                                               $.ajax({
                                                    url: 'http://localhost:3000/updatePosts/'+pid,
                                                    type: 'PATCH',
                                                    data: {done: 'true',       _method: "PATCH"},
                                                    success: function(res) {
                                                      console.log('huwat',res);
                                                    }
                                                    });                                               
                                             });                            
                                      }
                                      else{
                                        console.log(resp);
                                      }
                                  });
                          }
                           
                        }  
                        
                          }
                      else {
                        console.log('err getcomments',response)
                      
                      }
                    }
                );
          }
           //console.log('got it',responsee);
         
    });
  }

</script>

<script>
  $('.send').click(function(){
      var page_id = $('.pages option:selected').val();
      var message = $('.caption').val();   
    FB.api('/' + page_id, {fields: 'access_token'}, function(resp) {
        if(resp.access_token) {
            FB.api('/' + page_id + '/feed',
                'post',
                { message: message, access_token: resp.access_token }
                ,function(response) {

                  if(response && !response.error)
                  {
                     console.log('postedToPage',response);
                    $.post('http://localhost:3000/savePosts', {
                      postId: response.id,
                      tags: $('.tags').val(),
                      reply: $('.reply').val(),
                      pmReply:$('.pmReply').val(),
                      done: "false"

                    }).done(function (res){
                      console.log(res);
                    });
                  }
                  else{
                    alert('Error');
                  } 
            });
        }
    });
  

  })
  $('.logout').click(function(){
    FB.logout(function(response){
      location.href= "acme_homepage.html";
    })
  })
</script>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '140061199997196',
      cookie     : true,
      xfbml      : true,
      version    : 'v2.11'
    });      
      FB.getLoginStatus(function(response) {
      statusChangeCallback(response);
    });
      
  };
  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));

function checkLoginState() {
  FB.getLoginStatus(function(response) {
    console.log('loginstate:',response);
    statusChangeCallback(response);
  });
}

  function statusChangeCallback(response)
  {
    if  (response.status ==='connected')
    {
      $(".loginfb").hide();
       $(".fillupPage").show();
      console.log('Connected',response);     
      getPage();     
    }
    else{
      console.log('Not Connected');
      $(".loginfb").show();
       $(".fillupPage").hide();
    }
  }

function getPage()
{
  var opt = false;

  console.log('pages retrieved');
   FB.api('/me/accounts', function (response){
    console.log('pages',response.data);

    for(i=0 ; i < response.data.length ; i++){
        var newOption = $('<option>');
      newOption.attr('value', response.data[i].id).text(response.data[i].name);
      console.log('pahina',response.data[i].name);    
      $('.pages').append(newOption);  
      }   
      console.log('wew'); 
      $('.pages').material_select();
   });
}
    function pageposts()
    {
          FB.api(
        "/370721373035349/posts",
        function (response) {
          if (response && !response.error) {
            console.log('posts',response);
          }
          else{
            console.log('err posts',response);
          }
        }
    );
    FB.api(
    "/370721373035349/feed",
    function (response) {
      if (response && !response.error) {
        console.log('posts ID',response);
      }else {
        console.log('err posts ID', response);
      }
    }

);
     FB.api(
    "/370721373035349_1525595267547948/comments",
    {
        "summary": true,
        "filter": "toplevel"
    },
    function (response) {
      if (response && !response.error) {
        console.log('getcomments',response)
      }
      else {
        console.log('err getcomments',response)
      
      }
    }
);  
    }
</script>

 <script type="text/javascript">
  
  
  $('.chips-placeholder').material_chip({
    placeholder: 'Enter a tag',
    secondaryPlaceholder: '+Tag',
  });
 
 </script>
 <script>
$('.dropdown-button').dropdown({
      inDuration: 300,
      outDuration: 225,
      constrainWidth: false, 
      gutter: 0, 
      belowOrigin: true,
      alignment: 'left',
      stopPropagation: false 
    }
  );

     
  
</script>

<script>
   $(".fillupPage").hide();
$(document).ready(function(){
    $("#hide").click(function(){
        $(".loginfb").hide();
         $(".fillupPage").show();
    });
   
});
</script>



